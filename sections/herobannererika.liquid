{%- comment -%}
  Section: Full-Width Looping Video (Dawn-compatible)
  Purpose: Simple, multilingual-agnostic video player for full-bleed hero/background use.
  Features:
    • Full-width (edge-to-edge) layout
    • Autoplay + loop + muted + playsinline by default for mobile compatibility
    • Optional controls toggle
    • Supports multiple videos via blocks (MP4 URL or Vimeo ID)
    • Optional poster image for MP4
    • Adjustable height: auto (intrinsic) or fixed viewport height
  Usage:
    1) Save as sections/full-width-video.liquid
    2) In Theme Editor, add section “Full-Width Looping Video” and add one or more blocks.
{%- endcomment -%}

<style>
  .fw-video-section { position: relative; width: 100%; margin: 0; padding: 0; background: #000; }

  /* Edge-to-edge helper: ensures no theme page-width container limits width */
  .fw-video-wrap { width: 100%; }

  /* Fixed viewport height mode */
  .fw-video-fixed { position: relative; width: 100%; overflow: hidden; }
  .fw-video-fixed .fw-video, .fw-video-fixed .fw-iframe { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }

  /* Auto height (intrinsic) mode */
  .fw-video-auto .fw-video { width: 100%; height: auto; display: block; }
  .fw-video-auto .fw-iframe { width: 100%; aspect-ratio: 16 / 9; border: 0; display: block; }

  /* Optional overlay (if ever needed for text layering; kept minimal here) */
  .fw-overlay { position: absolute; inset: 0; pointer-events: none; }

  /* Reduce default section spacing if theme injects it */
  .fw-video-section .page-width, .fw-video-section .content-container { max-width: none; padding: 0; margin: 0; }

  @media (max-width: 750px) {
    .fw-video-fixed { min-height: 40vh; }
  }
</style>

<section class="fw-video-section" id="section-{{ section.id }}">
  <div class="fw-video-wrap
              {% if section.settings.height_mode == 'fixed' %}fw-video-fixed{% else %}fw-video-auto{% endif %}"
       style="{% if section.settings.height_mode == 'fixed' %}min-height: {{ section.settings.min_height_vh }}vh;{% endif %}">

    {%- if section.blocks.size > 0 -%}
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'mp4' -%}
            {%- assign show_controls = block.settings.show_controls -%}
            <video
              class="fw-video"
              {% if section.settings.height_mode == 'fixed' %}playsinline{% endif %}
              autoplay
              muted
              loop
              {% if show_controls %}controls{% endif %}
              preload="metadata"
              {% if block.settings.poster != blank %}poster="{{ block.settings.poster | image_url }}"{% endif %}
            >
              {%- if block.settings.mp4_url != blank -%}
                <source src="https://cdn.shopify.com/videos/c/o/v/41873abbf2b54cfba0bdf5431ea1de14.mp4" type="video/mp4">
              {%- endif -%}
              Your browser does not support the video tag.
            </video>

          {%- when 'vimeo' -%}
            {%- assign controls = block.settings.show_controls | default: false -%}
            {%- if block.settings.vimeo_id != blank -%}
              <iframe
                class="fw-iframe"
                src="https://player.vimeo.com/video/{{ block.settings.vimeo_id }}?autoplay=1&muted=1&loop=1&background={% if controls %}0{% else %}1{% endif %}&byline=0&title=0&portrait=0&controls={% if controls %}1{% else %}0{% endif %}"
                frameborder="0"
                allow="autoplay; fullscreen; picture-in-picture"
                loading="lazy"
                allowfullscreen
              ></iframe>
            {%- endif -%}
        {%- endcase -%}
      {%- endfor -%}
    {%- else -%}
      <div style="color:#fff;display:flex;align-items:center;justify-content:center;min-height:40vh;text-align:center;opacity:.7;">
        Add an MP4 or Vimeo block to this section.
      </div>
    {%- endif -%}

    {%- if section.settings.show_overlay -%}
      <div class="fw-overlay" style="background: linear-gradient(to bottom, rgba(0,0,0,{{ section.settings.overlay_top_opacity | divided_by: 100.0 }}), rgba(0,0,0,{{ section.settings.overlay_bottom_opacity | divided_by: 100.0 }}));"></div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Full-Width Looping Video",
  "tag": "section",
  "settings": [
    {
      "type": "select",
      "id": "height_mode",
      "label": "Height mode",
      "default": "fixed",
      "options": [
        {"value": "fixed", "label": "Fixed viewport height"},
        {"value": "auto",  "label": "Auto (intrinsic height)"}
      ]
    },
    {
      "type": "range",
      "id": "min_height_vh",
      "label": "Min height (vh)",
      "min": 30,
      "max": 100,
      "step": 5,
      "default": 60
    },
    {
      "type": "checkbox",
      "id": "show_overlay",
      "label": "Add dark gradient overlay",
      "default": false
    },
    {
      "type": "range",
      "id": "overlay_top_opacity",
      "label": "Overlay top opacity (%)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 0
    },
    {
      "type": "range",
      "id": "overlay_bottom_opacity",
      "label": "Overlay bottom opacity (%)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 40
    }
  ],
  "blocks": [
    {
      "type": "mp4",
      "name": "MP4 video",
      "limit": 10,
      "settings": [
        { "type": "text", "id": "mp4_url", "label": "MP4 URL (Shopify Files > copy URL)" },
        { "type": "image_picker", "id": "poster", "label": "Poster image (optional)" },
        { "type": "checkbox", "id": "show_controls", "label": "Show player controls", "default": false }
      ]
    },
    {
      "type": "vimeo",
      "name": "Vimeo video",
      "limit": 10,
      "settings": [
        { "type": "text", "id": "vimeo_id", "label": "Vimeo ID (digits only)" },
        { "type": "checkbox", "id": "show_controls", "label": "Show player controls", "default": false }
      ]
    }
  ],
  "presets": [
    { "name": "Full-Width Looping Video", "category": "Video" }
  ]
}
{% endschema %}