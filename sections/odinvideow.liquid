{% comment %}
  Rinosbike Ultra-Compact Carousel
  - User can see full card while navigating
  - Minimal specs display (grid-based, no scrolling)
  - Fast, accessible, mobile-first
  - Research-backed 2025 design practices
{% endcomment %}

<div class="comparison-carousel-section" 
     style="
       background-color: #ffffff;
       padding-top: {{ section.settings.padding_top }}px;
       padding-bottom: {{ section.settings.padding_bottom }}px;
     ">
  
  <div class="comparison-carousel-container" 
       style="max-width: {{ section.settings.container_width }}px; margin: 0 auto; padding: 0 {{ section.settings.container_padding }}px;">
    
    <!-- CAROUSEL ONLY - Compact, focused -->
    <div class="carousel-cards-side" style="width: 100%; display: flex; flex-direction: column;">
      
      {% if section.settings.carousel_label != blank %}
        <div style="margin-bottom: 14px;">
          <p style="font-size: 10px; color: #888; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">{{ section.settings.carousel_label }}</p>
        </div>
      {% endif %}

      <div class="carousel-viewport" 
           style="position: relative; overflow: hidden; display: flex; align-items: center; min-height: 210px;"
           role="region"
           aria-label="Bike models carousel"
           aria-live="polite">
        
        <div class="carousel-track" 
             style="display: flex; gap: 14px; transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); width: 100%;"
             data-gap="14"
             role="presentation">
          
          <!-- ODIN 1 -->
          <article class="carousel-card" 
                   style="flex: 0 0 100%; background: #fff; border: 1px solid #e5e5e5; border-radius: 6px; padding: 12px; transition: all 0.3s ease; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column;"
                   role="tabpanel"
                   aria-label="ODIN 1">
            
            <!-- Image: minimal height -->
            <div style="height: 70px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; overflow: hidden; border-radius: 4px; background: #f9f9f9;">
              <img src="https://rinosbike.com/cdn/shop/files/Odin_1_-_1_Gold_3b132dde-d88f-4b29-991c-6d77af4ceef4.png?v=1757929311&width=1346" alt="ODIN 1 gravel bike" loading="lazy" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
            
            <!-- Title: compact -->
            <h3 style="font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: #000; text-align: center; margin: 0 0 6px 0;">ODIN 1</h3>
            
            <!-- Specs: 2-column grid, no borders -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; flex: 1; margin-bottom: 8px; font-size: 11px;">
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.weight_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin1.weight' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.gears_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin1.gears' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.frame_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin1.frame' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.brakes_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin1.brakes' | t }}</div>
              </div>
            </div>
            
            <a href="/products/odin-1" style="display: block; padding: 8px 14px; background: #000; color: #fff; text-align: center; text-decoration: none; font-weight: 600; font-size: 10px; letter-spacing: 0.5px; border-radius: 3px; transition: all 0.2s ease; border: 1px solid #000; cursor: pointer;" class="buy-button" onmouseover="this.style.background='#333'; this.style.borderColor='#333'" onmouseout="this.style.background='#000'; this.style.borderColor='#000'">{{ section.settings.buy_button_text }}</a>
          </article>

          <!-- ODIN 3 -->
          <article class="carousel-card" 
                   style="flex: 0 0 100%; background: #fff; border: 1px solid #e5e5e5; border-radius: 6px; padding: 12px; transition: all 0.3s ease; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column;"
                   role="tabpanel"
                   aria-label="ODIN 3">
            
            <div style="height: 70px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; overflow: hidden; border-radius: 4px; background: #f9f9f9;">
              <img src="https://rinosbike.com/cdn/shop/files/Odin_3_-_1_Blue.png?v=1757928970&width=1346" alt="ODIN 3 gravel bike" loading="lazy" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
            
            <h3 style="font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: #000; text-align: center; margin: 0 0 6px 0;">ODIN 3</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; flex: 1; margin-bottom: 8px; font-size: 11px;">
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.weight_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin3.weight' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.gears_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin3.gears' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.frame_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin3.frame' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.brakes_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin3.brakes' | t }}</div>
              </div>
            </div>
            
            <a href="/products/odin-3" style="display: block; padding: 8px 14px; background: #000; color: #fff; text-align: center; text-decoration: none; font-weight: 600; font-size: 10px; letter-spacing: 0.5px; border-radius: 3px; transition: all 0.2s ease; border: 1px solid #000; cursor: pointer;" class="buy-button" onmouseover="this.style.background='#333'; this.style.borderColor='#333'" onmouseout="this.style.background='#000'; this.style.borderColor='#000'">{{ section.settings.buy_button_text }}</a>
          </article>

          <!-- ODIN 4 - FEATURED -->
          <article class="carousel-card is-featured" 
                   style="flex: 0 0 100%; background: #fff; border: 2px solid #000; border-radius: 6px; padding: 12px; transition: all 0.3s ease; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column; position: relative;"
                   role="tabpanel"
                   aria-label="ODIN 4 - Recommended">
            
            <div style="position: absolute; top: 10px; right: 10px; background: #000; color: white; padding: 4px 8px; font-size: 8px; font-weight: 700; letter-spacing: 0.5px; border-radius: 2px; z-index: 20;">{{ section.settings.featured_badge_text }}</div>
            
            <div style="height: 70px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; overflow: hidden; border-radius: 4px; background: #f9f9f9;">
              <img src="https://rinosbike.com/cdn/shop/files/Group_640.png?v=1758873763&width=1346" alt="ODIN 4 gravel bike" loading="lazy" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
            
            <h3 style="font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: #000; text-align: center; margin: 0 0 6px 0;">ODIN 4</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; flex: 1; margin-bottom: 8px; font-size: 11px;">
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.weight_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin4.weight' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.gears_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin4.gears' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.frame_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin4.frame' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.brakes_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin4.brakes' | t }}</div>
              </div>
            </div>
            
            <a href="/products/odin-4" style="display: block; padding: 8px 14px; background: #000; color: #fff; text-align: center; text-decoration: none; font-weight: 600; font-size: 10px; letter-spacing: 0.5px; border-radius: 3px; transition: all 0.2s ease; border: 1px solid #000; cursor: pointer;" class="buy-button" onmouseover="this.style.background='#333'; this.style.borderColor='#333'" onmouseout="this.style.background='#000'; this.style.borderColor='#000'">{{ section.settings.buy_button_text }}</a>
          </article>

          <!-- ODIN 6.0 -->
          <article class="carousel-card" 
                   style="flex: 0 0 100%; background: #fff; border: 1px solid #e5e5e5; border-radius: 6px; padding: 12px; transition: all 0.3s ease; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column;"
                   role="tabpanel"
                   aria-label="ODIN 6.0">
            
            <div style="height: 70px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; overflow: hidden; border-radius: 4px; background: #f9f9f9;">
              <img src="https://rinosbike.com/cdn/shop/files/ODIN6_1.png?v=1750755375&width=713" alt="ODIN 6.0 gravel bike" loading="lazy" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
            
            <h3 style="font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: #000; text-align: center; margin: 0 0 6px 0;">ODIN 6.0</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; flex: 1; margin-bottom: 8px; font-size: 11px;">
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.weight_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin6_0.weight' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.gears_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin6_0.gears' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.frame_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin6_0.frame' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.brakes_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin6_0.brakes' | t }}</div>
              </div>
            </div>
            
            <a href="/products/odin-6" style="display: block; padding: 8px 14px; background: #000; color: #fff; text-align: center; text-decoration: none; font-weight: 600; font-size: 10px; letter-spacing: 0.5px; border-radius: 3px; transition: all 0.2s ease; border: 1px solid #000; cursor: pointer;" class="buy-button" onmouseover="this.style.background='#333'; this.style.borderColor='#333'" onmouseout="this.style.background='#000'; this.style.borderColor='#000'">{{ section.settings.buy_button_text }}</a>
          </article>

          <!-- ODIN 6.1 -->
          <article class="carousel-card" 
                   style="flex: 0 0 100%; background: #fff; border: 1px solid #e5e5e5; border-radius: 6px; padding: 12px; transition: all 0.3s ease; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column;"
                   role="tabpanel"
                   aria-label="ODIN 6.1">
            
            <div style="height: 70px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; overflow: hidden; border-radius: 4px; background: #f9f9f9;">
              <img src="https://rinosbike.com/cdn/shop/files/1_edd71595-f78a-4465-9fa4-bc476b3d0b99.png?v=1751964247&width=713" alt="ODIN 6.1 gravel bike" loading="lazy" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
            
            <h3 style="font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: #000; text-align: center; margin: 0 0 6px 0;">ODIN 6.1</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; flex: 1; margin-bottom: 8px; font-size: 11px;">
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.weight_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin6_1.weight' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.gears_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin6_1.gears' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.frame_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin6_1.frame' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.brakes_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin6_1.brakes' | t }}</div>
              </div>
            </div>
            
            <a href="/products/odin-6-1" style="display: block; padding: 8px 14px; background: #000; color: #fff; text-align: center; text-decoration: none; font-weight: 600; font-size: 10px; letter-spacing: 0.5px; border-radius: 3px; transition: all 0.2s ease; border: 1px solid #000; cursor: pointer;" class="buy-button" onmouseover="this.style.background='#333'; this.style.borderColor='#333'" onmouseout="this.style.background='#000'; this.style.borderColor='#000'">{{ section.settings.buy_button_text }}</a>
          </article>

          <!-- ODIN 7.1 -->
          <article class="carousel-card" 
                   style="flex: 0 0 100%; background: #fff; border: 1px solid #e5e5e5; border-radius: 6px; padding: 12px; transition: all 0.3s ease; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column;"
                   role="tabpanel"
                   aria-label="ODIN 7.1">
            
            <div style="height: 70px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; overflow: hidden; border-radius: 4px; background: #f9f9f9;">
              <img src="https://rinosbike.com/cdn/shop/files/Odin_7_-_1_0fb3d058-3213-4d7b-8571-0964574deac9.png?v=1758275105&width=1346" alt="ODIN 7.1 gravel bike" loading="lazy" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
            
            <h3 style="font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: #000; text-align: center; margin: 0 0 6px 0;">ODIN 7.1</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; flex: 1; margin-bottom: 8px; font-size: 11px;">
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.weight_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin7_1.weight' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.gears_label' | t }}</div>
                <div style="color: #1a1a1a; font-weight: 600;">{{ 'bikes.odin7_1.gears' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.frame_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin7_1.frame' | t }}</div>
              </div>
              <div>
                <div style="color: #999; font-weight: 500; margin-bottom: 2px;">{{ 'bikes.brakes_label' | t }}</div>
                <div style="color: #1a1a1a;">{{ 'bikes.odin7_1.brakes' | t }}</div>
              </div>
            </div>
            
            <a href="/products/odin-7-1" style="display: block; padding: 8px 14px; background: #000; color: #fff; text-align: center; text-decoration: none; font-weight: 600; font-size: 10px; letter-spacing: 0.5px; border-radius: 3px; transition: all 0.2s ease; border: 1px solid #000; cursor: pointer;" class="buy-button" onmouseover="this.style.background='#333'; this.style.borderColor='#333'" onmouseout="this.style.background='#000'; this.style.borderColor='#000'">{{ section.settings.buy_button_text }}</a>
          </article>

        </div>
      </div>

      <!-- Navigation -->
      <div style="margin-top: 16px; text-align: center;">
        <div class="carousel-counter" style="font-size: 10px; color: #999; font-weight: 500; margin-bottom: 10px;" aria-live="polite">
          <span class="counter-text">1 of 6</span>
        </div>

        <div style="display: flex; justify-content: center; align-items: center; gap: 12px;">
          <button class="carousel-btn carousel-btn-prev" aria-label="Previous bike model" style="width: 40px; height: 40px; border: 1px solid #d0d0d0; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; color: #000; min-width: 40px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="15 18 9 12 15 6"></polyline></svg>
          </button>
          <div class="carousel-dots" style="display: flex; gap: 6px; align-items: center;"></div>
          <button class="carousel-btn carousel-btn-next" aria-label="Next bike model" style="width: 40px; height: 40px; border: 1px solid #d0d0d0; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; color: #000; min-width: 40px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="9 18 15 12 9 6"></polyline></svg>
          </button>
        </div>
      </div>

    </div>

  </div>
</div>

<style>
  @media (prefers-reduced-motion: reduce) {
    .carousel-track {
      transition: none !important;
    }
    .carousel-card, .carousel-btn, .carousel-dot {
      transition: none !important;
    }
  }
  
  @media (max-width: 768px) {
    .carousel-viewport { 
      min-height: 190px !important; 
    }
  }
  
  .carousel-card { 
    cursor: grab; 
  }
  
  .carousel-card:active { 
    cursor: grabbing; 
  }
  
  .carousel-card:hover { 
    border-color: #000; 
    transform: translateY(-2px); 
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important; 
  }
  
  .carousel-card:hover img { 
    transform: scale(1.04); 
  }
  
  .carousel-card.is-featured:hover { 
    border-color: #000; 
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12) !important; 
  }
  
  .carousel-btn:hover { 
    border-color: #000; 
    background: #f5f5f5; 
  }
  
  .carousel-btn:focus {
    outline: 2px solid #000;
    outline-offset: 2px;
  }
  
  .carousel-btn:active { 
    transform: scale(0.92); 
  }
  
  .carousel-dot { 
    width: 8px; 
    height: 8px; 
    border-radius: 50%; 
    background: #e0e0e0; 
    cursor: pointer; 
    transition: all 0.3s ease; 
    border: none; 
    padding: 0; 
  }
  
  .carousel-dot:focus {
    outline: 2px solid #000;
    outline-offset: 2px;
  }
  
  .carousel-dot.active { 
    background: #000; 
    width: 20px; 
    border-radius: 3px; 
  }
  
  .carousel-dot:hover { 
    background: #888; 
  }
  
  .buy-button:focus {
    outline: 2px solid #000;
    outline-offset: 2px;
  }
  
  .buy-button:hover { 
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12); 
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = {
      track: document.querySelector('.carousel-track'),
      cards: document.querySelectorAll('.carousel-card'),
      dotsContainer: document.querySelector('.carousel-dots'),
      counterText: document.querySelector('.counter-text'),
      prevBtn: document.querySelector('.carousel-btn-prev'),
      nextBtn: document.querySelector('.carousel-btn-next'),
      viewport: document.querySelector('.carousel-viewport'),
      currentIndex: 0,
      isTransitioning: false,
      startX: 0,
      isDragging: false,

      init() {
        this.createDots();
        this.attachEventListeners();
        this.setupTouchGestures();
        this.setupKeyboardNavigation();
        this.updateCarousel();
      },

      createDots() {
        this.cards.forEach((_, index) => {
          const dot = document.createElement('button');
          dot.className = 'carousel-dot';
          if (index === 0) dot.classList.add('active');
          dot.setAttribute('aria-label', `Go to bike model ${index + 1}`);
          dot.addEventListener('click', () => this.goToSlide(index));
          this.dotsContainer.appendChild(dot);
        });
      },

      attachEventListeners() {
        this.prevBtn.addEventListener('click', () => this.prev());
        this.nextBtn.addEventListener('click', () => this.next());
      },

      setupKeyboardNavigation() {
        this.viewport.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowLeft') {
            e.preventDefault();
            this.prev();
          } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            this.next();
          }
        });
      },

      setupTouchGestures() {
        let currentX = 0;
        this.track.addEventListener('mousedown', (e) => {
          this.startX = e.clientX;
          this.isDragging = true;
          this.track.style.cursor = 'grabbing';
        });
        document.addEventListener('mousemove', (e) => {
          if (!this.isDragging) return;
          currentX = e.clientX - this.startX;
        });
        document.addEventListener('mouseup', () => {
          if (!this.isDragging) return;
          this.isDragging = false;
          this.track.style.cursor = 'grab';
          if (Math.abs(currentX) > 50) currentX < 0 ? this.next() : this.prev();
        });
        this.track.addEventListener('touchstart', (e) => {
          this.startX = e.touches[0].clientX;
          this.isDragging = true;
        });
        this.track.addEventListener('touchmove', (e) => {
          if (!this.isDragging) return;
          currentX = e.touches[0].clientX - this.startX;
        });
        this.track.addEventListener('touchend', () => {
          if (!this.isDragging) return;
          this.isDragging = false;
          if (Math.abs(currentX) > 50) currentX < 0 ? this.next() : this.prev();
        });
      },

      prev() {
        if (this.isTransitioning) return;
        this.currentIndex = Math.max(0, this.currentIndex - 1);
        this.updateCarousel();
      },

      next() {
        if (this.isTransitioning) return;
        this.currentIndex = Math.min(this.cards.length - 1, this.currentIndex + 1);
        this.updateCarousel();
      },

      goToSlide(index) {
        if (this.isTransitioning) return;
        this.currentIndex = index;
        this.updateCarousel();
      },

      updateCarousel() {
        this.isTransitioning = true;
        const viewportWidth = this.viewport.offsetWidth;
        const gap = parseInt(this.track.dataset.gap) || 14;
        const offset = -(this.currentIndex * (viewportWidth + gap));
        this.track.style.transform = `translateX(${offset}px)`;
        this.updateDots();
        this.updateCounter();
        this.updateButtonStates();
        setTimeout(() => { this.isTransitioning = false; }, 400);
      },

      updateDots() {
        document.querySelectorAll('.carousel-dot').forEach((dot, index) => {
          dot.classList.toggle('active', index === this.currentIndex);
        });
      },

      updateCounter() {
        this.counterText.textContent = `${this.currentIndex + 1} of ${this.cards.length}`;
      },

      updateButtonStates() {
        this.prevBtn.disabled = this.currentIndex === 0;
        this.nextBtn.disabled = this.currentIndex === this.cards.length - 1;
        this.prevBtn.style.opacity = this.currentIndex === 0 ? '0.5' : '1';
        this.nextBtn.style.opacity = this.currentIndex === this.cards.length - 1 ? '0.5' : '1';
      }
    };
    carousel.init();
  });
</script>

{% schema %}
{
  "name": "Bike Carousel",
  "settings": [
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Section Padding Top",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Section Padding Bottom",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "container_width",
      "label": "Container Max Width",
      "min": 800,
      "max": 1400,
      "step": 50,
      "unit": "px",
      "default": 1100
    },
    {
      "type": "range",
      "id": "container_padding",
      "label": "Container Side Padding",
      "min": 0,
      "max": 80,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Labels & Text"
    },
    {
      "type": "text",
      "id": "carousel_label",
      "label": "Carousel Label",
      "default": "Compare All Models"
    },
    {
      "type": "text",
      "id": "featured_badge_text",
      "label": "Featured Badge Text",
      "default": "BEST SELLER"
    },
    {
      "type": "text",
      "id": "buy_button_text",
      "label": "Buy Button Text",
      "default": "VIEW"
    }
  ],
  "presets": [
    {
      "name": "Bike Carousel"
    }
  ]
}
{% endschema %}
