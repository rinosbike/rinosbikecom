{% comment %}
  Bike Comparison Widget
  Clean side-by-side comparison of 2 bikes
  Save as: sections/bike-comparison-widget.liquid
{% endcomment %}

<div class="bike-comparison-widget">
  <div class="comparison-container">
    
    <!-- Header -->
    <div class="comparison-header">
      <h3 class="comparison-title">Compare Odin Models</h3>
    </div>

    <!-- Bike Selectors -->
    <div class="bike-selectors">
      <div class="bike-selector current-bike">
        <label for="bike-1">This Bike</label>
        <div class="current-bike-display" id="current-bike-name">
          <!-- Auto-populated by JavaScript -->
        </div>
        <input type="hidden" id="bike-1" value="">
      </div>

      <div class="vs-divider">
        <span>VS</span>
      </div>

      <div class="bike-selector">
        <label for="bike-2">Compare With</label>
        <select id="bike-2" class="bike-select">
          <option value="">Select a bike...</option>
          <option value="odin1" data-image="https://rinosbike.com/cdn/shop/files/Odin_1_-_1_Gold_3b132dde-d88f-4b29-991c-6d77af4ceef4.png?v=1757929311&width=400">ODIN 1</option>
          <option value="odin3" data-image="https://rinosbike.com/cdn/shop/files/Odin_3_-_1_Blue.png?v=1757928970&width=400">ODIN 3</option>
          <option value="odin4" data-image="https://rinosbike.com/cdn/shop/files/Group_640.png?v=1758873763&width=400">ODIN 4</option>
          <option value="odin6_0" data-image="https://rinosbike.com/cdn/shop/files/ODIN6_1.png?v=1750755375&width=400">ODIN 6.0</option>
          <option value="odin6_1" data-image="https://rinosbike.com/cdn/shop/files/1_edd71595-f78a-4465-9fa4-bc476b3d0b99.png?v=1751964247&width=400">ODIN 6.1</option>
          <option value="odin7_1" data-image="https://rinosbike.com/cdn/shop/files/Odin_7_-_1_0fb3d058-3213-4d7b-8571-0964574deac9.png?v=1758275105&width=400">ODIN 7.1</option>
        </select>
      </div>
    </div>

    <!-- Comparison Table -->
    <div class="comparison-table-wrapper" id="comparison-content">
      <div class="comparison-images">
        <div class="bike-image-container">
          <img id="bike-1-image" src="" alt="Bike 1" class="bike-image">
          <h4 id="bike-1-name" class="bike-name"></h4>
        </div>
        <div class="bike-image-container">
          <img id="bike-2-image" src="" alt="Bike 2" class="bike-image">
          <h4 id="bike-2-name" class="bike-name"></h4>
        </div>
      </div>

      <table class="comparison-table">
        <thead>
          <tr>
            <th class="spec-label-col">Specification</th>
            <th id="bike-1-header">Bike 1</th>
            <th id="bike-2-header">Bike 2</th>
          </tr>
        </thead>
        <tbody id="comparison-tbody">
          <!-- Populated by JavaScript -->
        </tbody>
      </table>

      <div class="comparison-actions">
        <a href="#" id="bike-1-link" class="bike-link">View ODIN 1 →</a>
        <a href="#" id="bike-2-link" class="bike-link">View ODIN 3 →</a>
      </div>
    </div>

    <div class="empty-state" id="empty-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 11l3 3L22 4"></path>
        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
      </svg>
      <p>Select a bike above to compare</p>
    </div>

  </div>
</div>

<style>
.bike-comparison-widget {
  max-width: 900px;
  margin: 40px auto;
  padding: 0 16px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

/* Container */
.comparison-container {
  background: #fff;
  border-radius: 12px;
  padding: 32px;
}

/* Header */
.comparison-header {
  text-align: center;
  margin-bottom: 28px;
}

.comparison-title {
  font-size: 1.6em;
  font-weight: 700;
  color: #000;
  margin: 0;
}

/* Selectors Row */
.bike-selectors {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 24px;
  align-items: end;
  margin-bottom: 28px;
}

.bike-selector label {
  font-size: 0.8em;
  font-weight: 600;
  color: #444;
  letter-spacing: 0.5px;
  margin-bottom: 6px;
}

.current-bike-display {
  padding: 10px 14px;
  font-size: 1em;
  font-weight: 600;
  color: #000;
  background: #f6f6f6;
  border-radius: 8px;
}

.bike-select {
  padding: 10px 14px;
  background: #fafafa;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-weight: 600;
  transition: all 0.2s;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%23000' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
  background-position: right 14px center;
  background-repeat: no-repeat;
  padding-right: 40px;
}

.bike-select:hover,
.bike-select:focus {
  border-color: #000;
  background: #fff;
}

/* VS Circle */
.vs-divider {
  width: 42px;
  height: 42px;
  background: #000;
  border-radius: 50%;
  font-size: 0.8em;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Images */
.comparison-images {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 28px;
  margin-bottom: 20px;
}

.bike-image {
  width: 100%;
  max-height: 180px;
  object-fit: contain;
  background: #fafafa;
  padding: 16px;
  border-radius: 8px;
}

.bike-name {
  font-weight: 700;
  font-size: 1em;
  margin: 8px 0 0;
  color: #000;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Table */
.comparison-table-wrapper {
  display: none;
}

.comparison-table-wrapper.active {
  display: block;
}

.comparison-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}

.comparison-table thead th {
  padding: 12px 10px;
  font-size: 0.8em;
  background: #fafafa;
  color: #000;
  font-weight: 600;
}

.comparison-table tbody tr {
  border-bottom: 1px solid #eee;
}

.comparison-table tbody td {
  padding: 12px 10px;
  font-size: 0.9em;
}

.comparison-table tbody td:first-child {
  color: #666;
  font-size: 0.75em;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.comparison-table tbody tr.different {
  background: #fffef3;
}

.comparison-actions {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  padding-top: 16px;
  margin-top: 10px;
}

.bike-link {
  padding: 12px 16px;
  background: #000;
  color: #fff;
  text-align: center;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  font-size: 0.9em;
  transition: all 0.2s;
}

.bike-link:hover {
  opacity: 0.85;
  transform: translateY(-2px);
}

/* Empty State */
.empty-state {
  padding: 40px 10px;
  opacity: 0.8;
}

/* MOBILE */
@media (max-width: 768px) {
  .comparison-container {
    padding: 20px 16px;
  }

  .bike-selectors {
    grid-template-columns: 1fr;
    gap: 16px;
    text-align: center;
  }

  .vs-divider {
    margin: auto;
  }

  .comparison-images {
    grid-template-columns: 1fr;
  }

  .comparison-actions {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
// Bike data using translation keys structure
const bikeData = {
  odin1: {
    name: 'ODIN 1',
    url: '/products/odin-1',
    handle: 'odin-1',
    image: 'https://rinosbike.com/cdn/shop/files/Odin_1_-_1_Gold_3b132dde-d88f-4b29-991c-6d77af4ceef4.png?v=1757929311&width=400',
    weight: '{{ "bikes.odin1.weight" | t }}',
    gear: '{{ "bikes.odin1.gear" | t }}',
    gears: '{{ "bikes.odin1.gears" | t }}',
    frame: '{{ "bikes.odin1.frame" | t }}',
    frameSize: '{{ "bikes.odin1.frameSize" | t }}',
    brakes: '{{ "bikes.odin1.brakes" | t }}',
    wheelSize: '{{ "bikes.odin1.wheelSize" | t }}',
    rims: '{{ "bikes.odin1.rims" | t }}'
  },
  odin3: {
    name: 'ODIN 3',
    url: '/products/odin-3',
    handle: 'odin-3',
    image: 'https://rinosbike.com/cdn/shop/files/Odin_3_-_1_Blue.png?v=1757928970&width=400',
    weight: '{{ "bikes.odin3.weight" | t }}',
    gear: '{{ "bikes.odin3.gear" | t }}',
    gears: '{{ "bikes.odin3.gears" | t }}',
    frame: '{{ "bikes.odin3.frame" | t }}',
    frameSize: '{{ "bikes.odin3.frameSize" | t }}',
    brakes: '{{ "bikes.odin3.brakes" | t }}',
    wheelSize: '{{ "bikes.odin3.wheelSize" | t }}',
    rims: '{{ "bikes.odin3.rims" | t }}'
  },
  odin4: {
    name: 'ODIN 4',
    url: '/products/odin-4',
    handle: 'odin-4',
    image: 'https://rinosbike.com/cdn/shop/files/Group_640.png?v=1758873763&width=400',
    weight: '{{ "bikes.odin4.weight" | t }}',
    gear: '{{ "bikes.odin4.gear" | t }}',
    gears: '{{ "bikes.odin4.gears" | t }}',
    frame: '{{ "bikes.odin4.frame" | t }}',
    frameSize: '{{ "bikes.odin4.frameSize" | t }}',
    brakes: '{{ "bikes.odin4.brakes" | t }}',
    wheelSize: '{{ "bikes.odin4.wheelSize" | t }}',
    rims: '{{ "bikes.odin4.rims" | t }}'
  },
  odin6_0: {
    name: 'ODIN 6.0',
    url: '/products/odin-6',
    handle: 'odin-6',
    image: 'https://rinosbike.com/cdn/shop/files/ODIN6_1.png?v=1750755375&width=400',
    weight: '{{ "bikes.odin6_0.weight" | t }}',
    gear: '{{ "bikes.odin6_0.gear" | t }}',
    gears: '{{ "bikes.odin6_0.gears" | t }}',
    frame: '{{ "bikes.odin6_0.frame" | t }}',
    frameSize: '{{ "bikes.odin6_0.frameSize" | t }}',
    brakes: '{{ "bikes.odin6_0.brakes" | t }}',
    wheelSize: '{{ "bikes.odin6_0.wheelSize" | t }}',
    rims: '{{ "bikes.odin6_0.rims" | t }}'
  },
  odin6_1: {
    name: 'ODIN 6.1',
    url: '/products/odin-6-1',
    handle: 'odin-6-1',
    image: 'https://rinosbike.com/cdn/shop/files/1_edd71595-f78a-4465-9fa4-bc476b3d0b99.png?v=1751964247&width=400',
    weight: '{{ "bikes.odin6_1.weight" | t }}',
    gear: '{{ "bikes.odin6_1.gear" | t }}',
    gears: '{{ "bikes.odin6_1.gears" | t }}',
    frame: '{{ "bikes.odin6_1.frame" | t }}',
    frameSize: '{{ "bikes.odin6_1.frameSize" | t }}',
    brakes: '{{ "bikes.odin6_1.brakes" | t }}',
    wheelSize: '{{ "bikes.odin6_1.wheelSize" | t }}',
    rims: '{{ "bikes.odin6_1.rims" | t }}'
  },
  odin7_1: {
    name: 'ODIN 7.1',
    url: '/products/odin-7-1',
    handle: 'odin-7-1',
    image: 'https://rinosbike.com/cdn/shop/files/Odin_7_-_1_0fb3d058-3213-4d7b-8571-0964574deac9.png?v=1758275105&width=400',
    weight: '{{ "bikes.odin7_1.weight" | t }}',
    gear: '{{ "bikes.odin7_1.gear" | t }}',
    gears: '{{ "bikes.odin7_1.gears" | t }}',
    frame: '{{ "bikes.odin7_1.frame" | t }}',
    frameSize: '{{ "bikes.odin7_1.frameSize" | t }}',
    brakes: '{{ "bikes.odin7_1.brakes" | t }}',
    wheelSize: '{{ "bikes.odin7_1.wheelSize" | t }}',
    rims: '{{ "bikes.odin7_1.rims" | t }}'
  }
};

const specLabels = {
  weight: '{{ "bikes.weight_label" | t }}',
  gear: '{{ "bikes.gear_label" | t }}',
  gears: '{{ "bikes.gears_label" | t }}',
  frame: '{{ "bikes.frame_label" | t }}',
  frameSize: '{{ "bikes.frameSize_label" | t }}',
  brakes: '{{ "bikes.brakes_label" | t }}',
  wheelSize: '{{ "bikes.wheelSize_label" | t }}',
  rims: '{{ "bikes.rims_label" | t }}'
};

function detectCurrentBike() {
  // Try to get from Shopify product object first
  {% if product %}
    const productHandle = '{{ product.handle }}';
    
    // Map product handles to bike keys
    const handleMap = {
      'odin-1': 'odin1',
      'odin-3': 'odin3',
      'odin-4': 'odin4',
      'odin-6': 'odin6_0',
      'odin-6-1': 'odin6_1',
      'odin-7-1': 'odin7_1'
    };
    
    return handleMap[productHandle] || null;
  {% else %}
    // Fallback: detect from URL
    const path = window.location.pathname;
    for (const [key, data] of Object.entries(bikeData)) {
      if (path.includes(data.handle)) {
        return key;
      }
    }
    return null;
  {% endif %}
}

function initializeComparison() {
  const currentBikeKey = detectCurrentBike();
  
  if (!currentBikeKey) {
    // Not on a bike product page - hide widget or show message
    document.querySelector('.bike-comparison-widget').style.display = 'none';
    return;
  }
  
  const currentBike = bikeData[currentBikeKey];
  
  // Set current bike display
  document.getElementById('current-bike-name').textContent = currentBike.name;
  document.getElementById('bike-1').value = currentBikeKey;
  
  // Update bike 1 image and header
  document.getElementById('bike-1-image').src = currentBike.image;
  document.getElementById('bike-1-name').textContent = currentBike.name;
  document.getElementById('bike-1-header').textContent = currentBike.name;
  document.getElementById('bike-1-link').href = currentBike.url;
  document.getElementById('bike-1-link').textContent = `View ${currentBike.name} →`;
  
  // Remove current bike from bike 2 dropdown
  const bike2Select = document.getElementById('bike-2');
  const bike2Options = bike2Select.querySelectorAll('option');
  bike2Options.forEach(option => {
    if (option.value === currentBikeKey) {
      option.remove();
    }
  });
  
  // Add change listener for bike 2
  bike2Select.addEventListener('change', updateComparison);
}

function updateComparison() {
  const bike1Key = document.getElementById('bike-1').value;
  const bike2Key = document.getElementById('bike-2').value;

  const comparisonContent = document.getElementById('comparison-content');
  const emptyState = document.getElementById('empty-state');

  if (!bike2Key) {
    comparisonContent.classList.remove('active');
    emptyState.classList.remove('hidden');
    return;
  }

  const bike1 = bikeData[bike1Key];
  const bike2 = bikeData[bike2Key];

  // Update bike 2 image
  const bike2Option = document.getElementById('bike-2').options[document.getElementById('bike-2').selectedIndex];
  
  document.getElementById('bike-2-image').src = bike2Option.dataset.image;
  document.getElementById('bike-2-name').textContent = bike2.name;

  // Update headers
  document.getElementById('bike-2-header').textContent = bike2.name;

  // Update links
  document.getElementById('bike-2-link').href = bike2.url;
  document.getElementById('bike-2-link').textContent = `View ${bike2.name} →`;

  // Build comparison table
  const tbody = document.getElementById('comparison-tbody');
  tbody.innerHTML = '';

  Object.keys(specLabels).forEach(key => {
    const row = document.createElement('tr');
    const isDifferent = bike1[key] !== bike2[key];
    
    if (isDifferent) {
      row.classList.add('different');
    }

    row.innerHTML = `
      <td>${specLabels[key]}</td>
      <td>${bike1[key]}</td>
      <td>${bike2[key]}</td>
    `;
    tbody.appendChild(row);
  });

  comparisonContent.classList.add('active');
  emptyState.classList.add('hidden');
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', initializeComparison);
</script>

{% schema %}
{
  "name": "Bike Comparison",
  "settings": [
    {
      "type": "paragraph",
      "content": "Side-by-side bike comparison widget. Specs pulled from translation keys."
    }
  ],
  "presets": [
    {
      "name": "Bike Comparison"
    }
  ]
}
{% endschema %}
